<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Personal DeepL Translator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* Enhanced Micro-interaction animations */
        @keyframes pulse-scale {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        @keyframes slide-in {
            from { transform: translateY(-10px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @keyframes fade-in {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes ripple {
            0% {
                transform: scale(0);
                opacity: 1;
            }
            100% {
                transform: scale(4);
                opacity: 0;
            }
        }

        @keyframes character-count-pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); color: #3B82F6; }
            100% { transform: scale(1); }
        }

        @keyframes swap-rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes loading-pulse {
            0% { opacity: 0.6; }
            50% { opacity: 1; }
            100% { opacity: 0.6; }
        }

        .ripple-effect {
            position: relative;
            overflow: hidden;
        }

        .ripple-effect::after {
            content: '';
            position: absolute;
            width: 5px;
            height: 5px;
            background: rgba(255, 255, 255, 0.7);
            border-radius: 100%;
            animation: ripple 0.6s linear;
            pointer-events: none;
        }

        .animate-character-count {
            animation: character-count-pulse 0.3s ease-out;
        }

        .animate-swap {
            animation: swap-rotate 0.5s ease-out;
        }

        .loading-pulse {
            animation: loading-pulse 1.5s ease-in-out infinite;
        }

        /* Enhanced button effects */
        .micro-button {
            position: relative;
            transform: translateY(0) scale(1);
            transition: all 0.15s ease-out;
        }

        .micro-button:hover {
            transform: translateY(-1px) scale(1.05);
        }

        .micro-button:active {
            transform: translateY(1px) scale(0.95);
        }

        /* Enhanced focus states */
        textarea:focus, input:focus {
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.3);
            border-color: #3B82F6;
            transition: all 0.2s ease-out;
        }

        /* Success animation container */
        .success-animation {
            position: relative;
        }

        .success-animation::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 20px;
            height: 20px;
            background: rgba(59, 130, 246, 0.2);
            border-radius: 50%;
            transform: translate(-50%, -50%) scale(0);
            animation: success-ripple 0.6s ease-out;
        }

        @keyframes success-ripple {
            0% { transform: translate(-50%, -50%) scale(0); opacity: 1; }
            100% { transform: translate(-50%, -50%) scale(20); opacity: 0; }
        }

        /* Language swap animation */
        .swap-container {
            position: relative;
            perspective: 1000px;
        }

        .swap-content {
            transition: transform 0.3s ease-out;
            transform-style: preserve-3d;
        }

        .swapping .swap-content {
            transform: rotateX(180deg);
        }

        /* Add responsive text sizes */
        @media (max-width: 640px) {
            .text-lg {
                font-size: 1rem;
                line-height: 1.5rem;
            }
            
            textarea {
                font-size: 1rem;
                line-height: 1.5rem;
            }
        }

        /* Adjust modal padding for mobile */
        @media (max-width: 640px) {
            #apiKeyModal .max-w-md,
            #documentModal .max-w-md {
                margin: 0.5rem;
                padding: 1rem;
            }
        }
    </style>
    <script>
        tailwind.config = {
            darkMode: 'class'
        }
    </script>
</head>
<body class="bg-gradient-to-br from-blue-50 to-gray-100 dark:from-gray-900 dark:to-gray-800 min-h-screen transition-colors duration-200">
    <!-- Minimal Header -->
    <header class="bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm border-b border-gray-200 dark:border-gray-700 fixed top-0 left-0 right-0 z-50">
        <div class="container mx-auto h-12 sm:h-14 px-3 sm:px-6 relative flex items-center">
            <!-- Left side -->
            <div class="absolute left-3 sm:left-6">
                <img src="https://www.deepl.com/img/logo/deepl-logo-blue.svg" alt="DeepL Logo" class="h-5 sm:h-6 dark:invert">
            </div>
            
            <!-- Right side -->
            <div class="absolute right-3 sm:right-6 flex items-center gap-2 sm:gap-4">
                <!-- API Usage Bar -->
                <div class="hidden sm:flex items-center gap-2" title="API Usage">
                    <div class="w-24 sm:w-32 h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden">
                        <div id="apiUsageBar" class="h-full bg-blue-500 dark:bg-blue-400 transition-all duration-300" style="width: 0%"></div>
                    </div>
                    <span id="apiUsageText" class="text-xs text-gray-600 dark:text-gray-400">0%</span>
                </div>

                <!-- Buttons -->
                <button onclick="openDocumentModal()" 
                    class="p-1.5 sm:p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors text-gray-600 dark:text-gray-300 micro-button"
                    title="Translate Document">
                    <i class="fas fa-file-upload text-sm sm:text-base"></i>
                </button>

                <button onclick="openApiKeyModal()" 
                    class="p-1.5 sm:p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors text-gray-600 dark:text-gray-300 micro-button"
                    title="Configure API Key">
                    <i class="fas fa-key text-sm sm:text-base"></i>
                </button>

                <button onclick="toggleTheme()" 
                    class="p-1.5 sm:p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors text-gray-600 dark:text-gray-300 micro-button"
                    title="Toggle theme">
                    <i class="fas fa-sun text-sm sm:text-base"></i>
                </button>
            </div>
        </div>
    </header>

    <main class="container mx-auto px-2 sm:px-4 pt-14 sm:pt-16 pb-4 max-w-[1920px] h-[calc(100vh-3rem)]">
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg h-full transition-colors duration-200">
            <div class="grid grid-cols-1 lg:grid-cols-2 h-full relative">
                <!-- Input Section -->
                <div class="relative h-full flex flex-col border-b lg:border-b-0 lg:border-r border-gray-200 dark:border-gray-700">
                    <div class="flex justify-between items-center h-[44px] sm:h-[52px] px-3 sm:px-4 border-b border-gray-200 dark:border-gray-700">
                        <div class="flex items-center gap-3">
                            <label class="text-sm font-medium text-gray-700 dark:text-gray-300">Input Text</label>
                        </div>
                        <div class="flex items-center gap-2">
                            <span id="autoTranslateStatus" class="text-xs text-gray-500 dark:text-gray-400 hidden">
                                Auto-translating...
                            </span>
                            <span id="inputCount" class="text-sm text-gray-500 dark:text-gray-400">0/5000</span>
                        </div>
                    </div>
                    <div class="relative group flex-grow">
                        <textarea id="inputText" maxlength="5000" 
                            class="w-full h-full p-4 border-0 focus:ring-0 bg-transparent dark:text-white resize-none text-lg" 
                            placeholder="Enter text to translate..."></textarea>
                        <div class="absolute right-2 top-2 flex gap-2 opacity-0 group-hover:opacity-100 transition-opacity">
                            <button onclick="clearInput()" 
                                class="p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors"
                                title="Clear text">
                                <i class="fas fa-times"></i>
                            </button>
                            <button onclick="pasteFromClipboard()" 
                                class="p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors"
                                title="Paste from clipboard">
                                <i class="fas fa-paste"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Swap Button with larger background coverage -->
                <div class="fixed lg:absolute bottom-4 lg:bottom-auto right-4 lg:right-auto lg:left-1/2 lg:top-1/2 lg:transform lg:-translate-x-1/2 lg:-translate-y-1/2 z-20">
                    <div class="bg-white dark:bg-gray-800 rounded-full p-0.5 shadow-lg">
                        <button onclick="swapLanguages()" 
                            class="p-3 lg:p-2 rounded-full bg-blue-500 dark:bg-blue-600 shadow-lg hover:bg-blue-600 dark:hover:bg-blue-700 transition-colors text-white micro-button border border-blue-400 dark:border-blue-500"
                            title="Swap languages (Ctrl+S)">
                            <i class="fas fa-exchange-alt text-lg lg:text-base"></i>
                        </button>
                    </div>
                </div>
                
                <!-- Output Section -->
                <div class="relative h-full flex flex-col">
                    <div class="flex justify-between items-center h-[44px] sm:h-[52px] px-3 sm:px-4 border-b border-gray-200 dark:border-gray-700">
                        <div class="flex items-center gap-3">
                            <label class="text-sm font-medium text-gray-700 dark:text-gray-300">Translated Text</label>
                            <div class="h-4 w-px bg-gray-200 dark:bg-gray-600"></div>
                            <select id="targetLang" onchange="handleLanguageChange()" 
                                class="text-sm border-0 bg-transparent focus:ring-0 text-gray-600 dark:text-gray-300 cursor-pointer hover:text-gray-900 dark:hover:text-white transition-colors">
                                <option value="BG">Bulgarian</option>
                                <option value="CS">Czech</option>
                                <option value="DA">Danish</option>
                                <option value="DE">German</option>
                                <option value="EL">Greek</option>
                                <option value="EN-GB">English (British)</option>
                                <option value="EN-US" selected>English (American)</option>
                                <option value="ES">Spanish</option>
                                <option value="ET">Estonian</option>
                                <option value="FI">Finnish</option>
                                <option value="FR">French</option>
                                <option value="HU">Hungarian</option>
                                <option value="ID">Indonesian</option>
                                <option value="IT">Italian</option>
                                <option value="LT">Lithuanian</option>
                                <option value="LV">Latvian</option>
                                <option value="NL">Dutch</option>
                                <option value="PL">Polish</option>
                                <option value="PT-BR">Portuguese (Brazilian)</option>
                                <option value="PT-PT">Portuguese (European)</option>
                                <option value="RO">Romanian</option>
                                <option value="SK">Slovak</option>
                                <option value="SL">Slovenian</option>
                                <option value="SV">Swedish</option>
                                <option value="TR">Turkish</option>
                                <option value="JA">Japanese</option>
                                <option value="ZH">Chinese (Simplified)</option>
                                <option value="KO">Korean</option>
                            </select>
                        </div>
                        <div class="flex items-center gap-2">
                            <button onclick="copyTranslation()" 
                                class="inline-flex items-center gap-1 px-2 h-8 text-sm text-blue-600 dark:text-blue-400 hover:text-blue-700 dark:hover:text-blue-300 hover:bg-blue-50 dark:hover:bg-gray-700 rounded-lg transition-colors"
                                title="Copy translation exactly as shown">
                                <i class="far fa-copy"></i>
                                Copy
                            </button>
                            <div class="relative group">
                                <button onclick="xCopyTranslation()" 
                                    class="inline-flex items-center gap-1 px-2 h-8 text-sm text-blue-600 dark:text-blue-400 hover:text-blue-700 dark:hover:text-blue-300 hover:bg-blue-50 dark:hover:bg-gray-700 rounded-lg transition-colors">
                                    <i class="fas fa-broom"></i>
                                    XCopy
                                    <i class="fas fa-info-circle ml-1 text-gray-400 cursor-pointer" onclick="toggleTooltip(event)"></i>
                                </button>
                                <!-- Updated Tooltip -->
                                <div id="xcopyTooltip" class="absolute top-full right-0 mt-2 z-50 hidden">
                                    <div class="bg-gray-800 text-white text-xs rounded-lg shadow-lg p-3 w-64">
                                        <p class="font-medium mb-2">XCopy (Clean Copy):</p>
                                        <ul class="space-y-1 ml-4 list-disc text-gray-200">
                                            <li>Removes extra spaces between words</li>
                                            <li>Removes all types of line breaks and newlines</li>
                                            <li>Removes leading/trailing whitespace</li>
                                        </ul>
                                        <div class="absolute top-0 right-4 w-2 h-2 bg-gray-800 transform -translate-y-1/2 rotate-45"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="relative group flex-grow">
                        <textarea id="outputText"
                            class="w-full h-full p-4 border-0 focus:ring-0 bg-transparent dark:text-white resize-none text-lg" 
                            readonly></textarea>
                        <div id="loadingIndicator" class="hidden absolute inset-0 bg-gray-50 dark:bg-gray-700 bg-opacity-50 flex items-center justify-center backdrop-blur-sm">
                            <div class="flex flex-col items-center gap-3">
                                <div class="animate-spin rounded-full h-10 w-10 border-b-2 border-blue-600 dark:border-blue-400"></div>
                                <span class="text-blue-600 dark:text-blue-400">Translating...</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Add API Key Modal -->
    <div id="apiKeyModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-xl max-w-md w-full mx-4 p-6">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold text-gray-800 dark:text-white">Configure DeepL API Key</h2>
                <button onclick="closeApiKeyModal()" class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">API Key</label>
                    <input type="text" id="apiKeyInput" 
                        class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg 
                        focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 
                        text-gray-900 dark:text-white placeholder-gray-400 dark:placeholder-gray-500"
                        placeholder="Enter your DeepL API key">
                </div>
                
                <!-- Add detailed instructions -->
                <div class="text-sm text-gray-600 dark:text-gray-400 space-y-3">
                    <p class="font-medium">How to get your DeepL API key:</p>
                    <ol class="list-decimal list-inside space-y-2">
                        <li>Go to <a href="https://www.deepl.com/pro-api" target="_blank" 
                            class="text-blue-600 dark:text-blue-400 hover:underline">DeepL API</a> and sign up for an account</li>
                        <li>Choose between Free or Pro API plan</li>
                        <li>After registration, go to your <a href="https://www.deepl.com/account/summary" target="_blank" 
                            class="text-blue-600 dark:text-blue-400 hover:underline">Account Summary</a></li>
                        <li>Copy your Authentication Key (API key)</li>
                        <li>Paste it here and click Save</li>
                    </ol>
                    <div class="mt-3 p-3 bg-blue-50 dark:bg-gray-700 rounded-lg">
                        <p class="text-blue-800 dark:text-blue-300">
                            <i class="fas fa-info-circle mr-2"></i>
                            Free API accounts have a limit of 500,000 characters per month. The usage bar above will help you track your usage.
                        </p>
                    </div>
                </div>
                
                <div class="flex justify-end gap-3 mt-6">
                    <button onclick="closeApiKeyModal()" 
                        class="px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors">
                        Cancel
                    </button>
                    <button onclick="saveApiKey()" 
                        class="px-4 py-2 text-sm bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                        Save
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add this new modal -->
    <div id="documentModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 backdrop-blur-sm">
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-xl max-w-md w-full mx-4 p-6">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold text-gray-800 dark:text-white">Translate Document</h2>
                <button onclick="closeDocumentModal()" class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Select Document</label>
                    <input type="file" id="documentInput" 
                        class="block w-full text-sm text-gray-500 dark:text-gray-400
                        file:mr-4 file:py-2 file:px-4
                        file:rounded-lg file:border-0
                        file:text-sm file:font-medium
                        file:bg-blue-50 file:text-blue-700
                        dark:file:bg-gray-700 dark:file:text-blue-400
                        hover:file:bg-blue-100 dark:hover:file:bg-gray-600
                        file:cursor-pointer">
                    <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">
                        Supported formats: .docx, .doc, .pptx, .xlsx, .pdf, .html, .txt, .xlf, .srt
                    </p>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Target Language</label>
                    <select id="documentTargetLang" 
                        class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg 
                        focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 
                        text-gray-900 dark:text-white">
                        <!-- Use the same options as your main translation select -->
                    </select>
                </div>

                <div id="documentProgress" class="hidden">
                    <div class="h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden">
                        <div class="h-full bg-blue-500 dark:bg-blue-400 transition-all duration-300 w-full animate-pulse"></div>
                    </div>
                    <p class="text-sm text-center mt-2 text-gray-600 dark:text-gray-400">Translating document...</p>
                </div>

                <div class="flex justify-end gap-3 mt-6">
                    <button onclick="closeDocumentModal()" 
                        class="px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors">
                        Cancel
                    </button>
                    <button onclick="translateDocument()" 
                        class="px-4 py-2 text-sm bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                        Translate
                    </button>
                </div>

                <div class="p-3 bg-yellow-50 dark:bg-gray-700 rounded-lg">
                    <p class="text-yellow-800 dark:text-yellow-300 text-sm">
                        <i class="fas fa-exclamation-triangle mr-2"></i>
                        <strong>Note:</strong> Document translation may consume more API quota than expected due to document processing overhead. Consider extracting text for short content.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <script>
        const inputText = document.getElementById('inputText');
        const outputText = document.getElementById('outputText');
        const inputCount = document.getElementById('inputCount');
        const loadingIndicator = document.getElementById('loadingIndicator');

        // Theme handling
        function toggleTheme() {
            document.documentElement.classList.toggle('dark');
            localStorage.setItem('theme', document.documentElement.classList.contains('dark') ? 'dark' : 'light');
        }

        // Set initial theme
        if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.classList.add('dark');
        }

        let translateTimeout;
        const TRANSLATE_DELAY = 500; // ms delay before translating

        // Enhanced character count update
        let previousCount = 0;
        function updateCharacterCount(count) {
            const countElement = document.getElementById('inputCount');
            countElement.textContent = `${count}/5000`;
            
            if (count !== previousCount) {
                countElement.classList.remove('animate-character-count');
                void countElement.offsetWidth; // Force reflow
                countElement.classList.add('animate-character-count');
            }
            previousCount = count;
        }

        // Enhanced input handler
        inputText.addEventListener('input', function() {
            updateCharacterCount(this.value.length);
            
            if (this.value.length > 0) {
                this.classList.add('text-gray-900', 'dark:text-white');
            } else {
                this.classList.remove('text-gray-900', 'dark:text-white');
                outputText.value = '';
            }

            clearTimeout(translateTimeout);
            
            if (this.value.trim()) {
                document.getElementById('autoTranslateStatus').classList.remove('hidden');
                translateTimeout = setTimeout(() => {
                    translateText();
                }, TRANSLATE_DELAY);
            } else {
                document.getElementById('autoTranslateStatus').classList.add('hidden');
            }
        });

        // Add language change handler
        function handleLanguageChange() {
            if (inputText.value.trim()) {
                clearTimeout(translateTimeout);
                translateTimeout = setTimeout(() => {
                    translateText();
                }, TRANSLATE_DELAY);
            }
        }

        async function pasteFromClipboard() {
            try {
                const text = await navigator.clipboard.readText();
                inputText.value = text;
                inputCount.textContent = `${text.length}/5000`;
            } catch (err) {
                alert('Failed to read clipboard');
            }
        }

        function clearInput() {
            inputText.value = '';
            outputText.value = '';
            inputCount.textContent = '0/5000';
        }

        function copyTranslation() {
            outputText.select();
            document.execCommand('copy');
            const button = document.querySelector('button[onclick="copyTranslation()"]');
            
            // Add success animation
            button.classList.add('success-animation');
            button.innerHTML = '<i class="fas fa-check"></i> Copied!';
            button.classList.add('bg-blue-50', 'dark:bg-gray-700', 'animate-pulse-scale');
            
            setTimeout(() => {
                button.classList.remove('success-animation', 'bg-blue-50', 'dark:bg-gray-700', 'animate-pulse-scale');
                button.innerHTML = '<i class="far fa-copy"></i> Copy';
            }, 2000);
        }

        function xCopyTranslation() {
            const text = outputText.value;
            // Clean the text:
            // 1. Replace multiple spaces with single space
            // 2. Replace all types of line breaks with space
            // 3. Trim leading/trailing whitespace
            const cleanedText = text
                .replace(/\s+/g, ' ')      // Replace multiple spaces/tabs/line breaks with single space
                .trim();                   // Remove leading/trailing whitespace

            // Copy to clipboard
            navigator.clipboard.writeText(cleanedText).then(() => {
                const button = document.querySelector('button[onclick="xCopyTranslation()"]');
                const originalContent = '<i class="fas fa-broom"></i> XCopy <i class="fas fa-info-circle ml-1 text-gray-400 cursor-pointer" onclick="toggleTooltip(event)"></i>';
                button.innerHTML = '<i class="fas fa-check"></i> Cleaned and copied!';
                button.classList.add('bg-blue-50', 'dark:bg-gray-700');
                setTimeout(() => {
                    button.innerHTML = originalContent;
                    button.classList.remove('bg-blue-50', 'dark:bg-gray-700');
                }, 2000);
            }).catch(err => {
                console.error('Failed to copy text:', err);
            });
        }

        function swapLanguages() {
            const container = document.querySelector('.grid');
            const button = document.querySelector('button[onclick="swapLanguages()"]');
            
            button.classList.add('animate-swap');
            container.classList.add('swapping');
            
            if (inputText.value.trim() || outputText.value.trim()) {
                const tempText = inputText.value;
                inputText.value = outputText.value;
                outputText.value = tempText;
                updateCharacterCount(inputText.value.length);
                
                if (inputText.value.trim()) {
                    translateText();
                }
            }
            
            setTimeout(() => {
                button.classList.remove('animate-swap');
                container.classList.remove('swapping');
            }, 500);
        }

        // Update keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey || e.metaKey) {
                switch(e.key) {
                    case 's':
                        e.preventDefault();
                        swapLanguages();
                        break;
                    case 'l':
                        e.preventDefault();
                        clearInput();
                        break;
                    case 'c':
                        if (document.activeElement !== outputText) {
                            e.preventDefault();
                            copyTranslation();
                        }
                        break;
                    case 'x':  // Add shortcut for XCopy
                        if (document.activeElement !== outputText) {
                            e.preventDefault();
                            xCopyTranslation();
                        }
                        break;
                    case 'd':
                        e.preventDefault();
                        toggleTheme();
                        break;
                }
            } else if (e.key === 'Escape') {
                shortcutsModal.classList.add('hidden');
            }
        });

        // Add API usage tracking
        let apiUsage = {
            character_count: 0,
            character_limit: 500000  // Default monthly limit, update this based on your plan
        };

        // Function to update API usage display
        function updateApiUsage(characterCount) {
            apiUsage.character_count = characterCount;
            const usagePercent = Math.min((apiUsage.character_count / apiUsage.character_limit) * 100, 100);
            
            const usageBar = document.getElementById('apiUsageBar');
            const usageText = document.getElementById('apiUsageText');
            
            usageBar.style.width = `${usagePercent}%`;
            usageText.textContent = `${Math.round(usagePercent)}%`;

            // Update color based on usage
            if (usagePercent > 90) {
                usageBar.classList.remove('bg-blue-500', 'dark:bg-blue-400');
                usageBar.classList.add('bg-red-500', 'dark:bg-red-400');
            } else if (usagePercent > 75) {
                usageBar.classList.remove('bg-blue-500', 'dark:bg-blue-400');
                usageBar.classList.add('bg-yellow-500', 'dark:bg-yellow-400');
            } else {
                usageBar.classList.remove('bg-red-500', 'dark:bg-red-400', 'bg-yellow-500', 'dark:bg-yellow-400');
                usageBar.classList.add('bg-blue-500', 'dark:bg-blue-400');
            }
        }

        // Enhanced translate function with success feedback
        async function translateText() {
            const text = inputText.value.trim();
            const targetLang = document.getElementById('targetLang').value;
            const apiKey = localStorage.getItem('deepl_api_key');
            
            if (!text) {
                document.getElementById('autoTranslateStatus').classList.add('hidden');
                return;
            }

            if (!apiKey) {
                alert('Please configure your DeepL API key first');
                openApiKeyModal();
                return;
            }

            try {
                showLoading();
                const response = await fetch('/translate', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        text: text,
                        target_lang: targetLang,
                        source_lang: null,
                        api_key: apiKey
                    })
                });

                const data = await response.json();
                
                if (response.ok) {
                    outputText.classList.add('success-animation', 'animate-fade-in');
                    outputText.value = data.translated_text;
                    
                    setTimeout(() => {
                        outputText.classList.remove('success-animation', 'animate-fade-in');
                    }, 300);
                    
                    // Update API usage with the latest data
                    if (data.character_count !== undefined && data.character_limit !== undefined) {
                        apiUsage = {
                            character_count: data.character_count,
                            character_limit: data.character_limit
                        };
                        updateApiUsage(data.character_count);
                    }
                } else {
                    console.error('Translation failed:', data.error);
                    alert(data.error || 'Translation failed');
                }
            } catch (error) {
                console.error('Translation error:', error);
                alert('Translation failed. Please try again.');
            } finally {
                hideLoading();
                document.getElementById('autoTranslateStatus').classList.add('hidden');
            }
        }

        // Initial API usage check
        async function checkApiUsage() {
            const apiKey = localStorage.getItem('deepl_api_key');
            if (!apiKey) return;

            try {
                const response = await fetch('/api-usage', {
                    headers: {
                        'X-API-Key': apiKey
                    }
                });
                const data = await response.json();
                if (response.ok) {
                    apiUsage = data;
                    updateApiUsage(data.character_count);
                }
            } catch (error) {
                console.error('Failed to fetch API usage:', error);
            }
        }

        // Call initial API usage check
        checkApiUsage();

        // Schedule periodic API usage updates
        setInterval(checkApiUsage, 60000); // Check every minute

        // API Key Modal handling
        const apiKeyModal = document.getElementById('apiKeyModal');
        const apiKeyInput = document.getElementById('apiKeyInput');

        function openApiKeyModal() {
            apiKeyModal.classList.remove('hidden');
            setTimeout(() => {
                const modalContent = apiKeyModal.querySelector('div');
                modalContent.classList.add('animate-slide-in');
            }, 10);
            
            const savedApiKey = localStorage.getItem('deepl_api_key');
            if (savedApiKey) {
                apiKeyInput.value = savedApiKey;
            }
        }

        function closeApiKeyModal() {
            const modalContent = apiKeyModal.querySelector('div');
            modalContent.classList.add('opacity-0');
            modalContent.style.transition = 'opacity 0.2s ease-out';
            
            setTimeout(() => {
                apiKeyModal.classList.add('hidden');
                modalContent.classList.remove('opacity-0');
                modalContent.style.transition = '';
            }, 200);
        }

        async function saveApiKey() {
            const apiKey = apiKeyInput.value.trim();
            if (!apiKey) {
                alert('Please enter an API key');
                return;
            }

            try {
                // Test the API key
                const response = await fetch('/test-api-key', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ api_key: apiKey })
                });

                const data = await response.json();
                
                if (response.ok) {
                    localStorage.setItem('deepl_api_key', apiKey);
                    closeApiKeyModal();
                    location.reload(); // Reload to use new API key
                } else {
                    alert('Invalid API key: ' + data.error);
                }
            } catch (error) {
                alert('Failed to validate API key');
                console.error('API key validation error:', error);
            }
        }

        // Enhanced button click effect
        document.querySelectorAll('.micro-button').forEach(button => {
            button.addEventListener('click', function(e) {
                // Remove existing ripple
                this.classList.remove('ripple-effect');
                
                // Create ripple effect
                const rect = this.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                
                this.style.setProperty('--ripple-x', x + 'px');
                this.style.setProperty('--ripple-y', y + 'px');
                
                this.classList.add('ripple-effect');
            });
        });

        // Enhanced loading animation
        function showLoading() {
            loadingIndicator.classList.remove('hidden');
            loadingIndicator.classList.add('loading-pulse', 'animate-fade-in');
        }

        function hideLoading() {
            loadingIndicator.classList.remove('loading-pulse');
            loadingIndicator.classList.add('opacity-0');
            loadingIndicator.style.transition = 'opacity 0.2s ease-out';
            
            setTimeout(() => {
                loadingIndicator.classList.add('hidden');
                loadingIndicator.classList.remove('opacity-0', 'animate-fade-in');
                loadingIndicator.style.transition = '';
            }, 200);
        }

        // Enhanced modal animations
        function openApiKeyModal() {
            apiKeyModal.classList.remove('hidden');
            setTimeout(() => {
                const modalContent = apiKeyModal.querySelector('div');
                modalContent.classList.add('animate-slide-in');
            }, 10);
            
            const savedApiKey = localStorage.getItem('deepl_api_key');
            if (savedApiKey) {
                apiKeyInput.value = savedApiKey;
            }
        }

        function closeApiKeyModal() {
            const modalContent = apiKeyModal.querySelector('div');
            modalContent.classList.add('opacity-0');
            modalContent.style.transition = 'opacity 0.2s ease-out';
            
            setTimeout(() => {
                apiKeyModal.classList.add('hidden');
                modalContent.classList.remove('opacity-0');
                modalContent.style.transition = '';
            }, 200);
        }

        // Enhanced document modal animations
        function openDocumentModal() {
            documentModal.classList.remove('hidden');
            setTimeout(() => {
                const modalContent = documentModal.querySelector('div');
                modalContent.classList.add('animate-slide-in');
            }, 10);
            
            const documentTargetLang = document.getElementById('documentTargetLang');
            const mainTargetLang = document.getElementById('targetLang');
            documentTargetLang.innerHTML = mainTargetLang.innerHTML;
            documentTargetLang.value = mainTargetLang.value;
        }

        function closeDocumentModal() {
            const modalContent = documentModal.querySelector('div');
            modalContent.classList.add('opacity-0');
            modalContent.style.transition = 'opacity 0.2s ease-out';
            
            setTimeout(() => {
                documentModal.classList.add('hidden');
                modalContent.classList.remove('opacity-0');
                modalContent.style.transition = '';
                document.getElementById('documentInput').value = '';
                documentProgress.classList.add('hidden');
            }, 200);
        }

        // Enhanced input interactions
        inputText.addEventListener('focus', function() {
            this.classList.add('textarea-transition');
        });

        outputText.addEventListener('focus', function() {
            this.classList.add('textarea-transition');
        });

        // Enhanced copy animation
        function copyTranslation() {
            outputText.select();
            document.execCommand('copy');
            const button = document.querySelector('button[onclick="copyTranslation()"]');
            
            // Add success animation
            button.classList.add('success-animation');
            button.innerHTML = '<i class="fas fa-check"></i> Copied!';
            button.classList.add('bg-blue-50', 'dark:bg-gray-700', 'animate-pulse-scale');
            
            setTimeout(() => {
                button.classList.remove('success-animation', 'bg-blue-50', 'dark:bg-gray-700', 'animate-pulse-scale');
                button.innerHTML = '<i class="far fa-copy"></i> Copy';
            }, 2000);
        }

        // Enhanced swap languages animation
        function swapLanguages() {
            const container = document.querySelector('.grid');
            const button = document.querySelector('button[onclick="swapLanguages()"]');
            
            button.classList.add('animate-swap');
            container.classList.add('swapping');
            
            if (inputText.value.trim() || outputText.value.trim()) {
                const tempText = inputText.value;
                inputText.value = outputText.value;
                outputText.value = tempText;
                updateCharacterCount(inputText.value.length);
                
                if (inputText.value.trim()) {
                    translateText();
                }
            }
            
            setTimeout(() => {
                button.classList.remove('animate-swap');
                container.classList.remove('swapping');
            }, 500);
        }

        // Enhanced modal animations
        function openApiKeyModal() {
            apiKeyModal.classList.remove('hidden');
            setTimeout(() => {
                const modalContent = apiKeyModal.querySelector('div');
                modalContent.classList.add('animate-slide-in');
            }, 10);
            
            const savedApiKey = localStorage.getItem('deepl_api_key');
            if (savedApiKey) {
                apiKeyInput.value = savedApiKey;
            }
        }

        function closeApiKeyModal() {
            const modalContent = apiKeyModal.querySelector('div');
            modalContent.classList.add('opacity-0');
            modalContent.style.transition = 'opacity 0.2s ease-out';
            
            setTimeout(() => {
                apiKeyModal.classList.add('hidden');
                modalContent.classList.remove('opacity-0');
                modalContent.style.transition = '';
            }, 200);
        }

        // Enhanced document modal animations
        function openDocumentModal() {
            documentModal.classList.remove('hidden');
            setTimeout(() => {
                const modalContent = documentModal.querySelector('div');
                modalContent.classList.add('animate-slide-in');
            }, 10);
            
            const documentTargetLang = document.getElementById('documentTargetLang');
            const mainTargetLang = document.getElementById('targetLang');
            documentTargetLang.innerHTML = mainTargetLang.innerHTML;
            documentTargetLang.value = mainTargetLang.value;
        }

        function closeDocumentModal() {
            const modalContent = documentModal.querySelector('div');
            modalContent.classList.add('opacity-0');
            modalContent.style.transition = 'opacity 0.2s ease-out';
            
            setTimeout(() => {
                documentModal.classList.add('hidden');
                modalContent.classList.remove('opacity-0');
                modalContent.style.transition = '';
                document.getElementById('documentInput').value = '';
                documentProgress.classList.add('hidden');
            }, 200);
        }

        // Enhanced input interactions
        inputText.addEventListener('focus', function() {
            this.classList.add('textarea-transition');
        });

        outputText.addEventListener('focus', function() {
            this.classList.add('textarea-transition');
        });

        // Enhanced loading animation
        function showLoading() {
            loadingIndicator.classList.remove('hidden');
            loadingIndicator.classList.add('loading-pulse', 'animate-fade-in');
        }

        function hideLoading() {
            loadingIndicator.classList.remove('loading-pulse');
            loadingIndicator.classList.add('opacity-0');
            loadingIndicator.style.transition = 'opacity 0.2s ease-out';
            
            setTimeout(() => {
                loadingIndicator.classList.add('hidden');
                loadingIndicator.classList.remove('opacity-0', 'animate-fade-in');
                loadingIndicator.style.transition = '';
            }, 200);
        }
    </script>
</body>
</html>
